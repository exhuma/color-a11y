<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readable Colors</title>
    <style>
        #SliderGrid {
            margin-top: 1em;
            max-width: 500px;
            display: grid;
            grid-template-columns: 1fr 1fr 25px 25px 25px;
            row-gap: 10px;
        }
        #Swatch {
            width: 300px;
            height: 200px;
            border: 2px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
   <div id="Swatch">
    <div>
    Sample Text
    </div>
   </div> 
   <div id="SliderGrid">
    <span>BG Luminance</span><span id="BGLuminance" style="grid-column-start: span 4;">-</span>
    <span>FG Luminance</span><span id="FGLuminance" style="grid-column-start: span 4;">-</span>
    <span>Luminance Diff</span><span id="LuminanceDiff" style="grid-column-start: span 4;">-</span>
    <span>Red</span><input type="range" name="red" id="SliderRed" min="0" max="255">
    <button id="SubRed">-</button>
    <button id="AddRed">+</button>
    <span id="RedValue"></span>
    <span>Green</span><input type="range" name="green" id="SliderGreen" min="0" max="255">
    <button id="SubGreen">-</button>
    <button id="AddGreen">+</button>
    <span id="GreenValue"></span>
    <span>Blue</span><input type="range" name="blue" id="SliderBlue" min="0" max="255">
    <button id="SubBlue">-</button>
    <button id="AddBlue">+</button>
    <span id="BlueValue"></span>
    <span>Auto: <span id="AutoState">Off</span></span><input style="grid-column-start: span 4;" type="button" id="ButtonAuto" value="Toggle Auto" />
    <span>Grayscale</span><input style="grid-column-start: span 4;" type="checkbox" id="LinkSlidersToggle" value="off" />
    <span></span><span></span><span></span>
   </div>
    <script type="module">
        import { getReadableComplement } from './index';
        import { Color } from './cmath';

        var swatch = document.getElementById("Swatch");
        var elementIdNames = ["Red", "Green", "Blue"];
        var grayscale = false;

        function setGrayscale(state) {
            let lightness = document.getElementById(`Slider${elementIdNames[0]}`).value;
            elementIdNames.slice(1).map(name => {
                let elmt = document.getElementById(`Slider${name}`)
                elmt.disabled = grayscale;
                elmt.value = lightness;
                document.getElementById(`Sub${name}`).disabled = grayscale;
                document.getElementById(`Add${name}`).disabled = grayscale;
            });
        }

        function incrementor(name) {
            return () => {
                const slider = document.getElementById(`Slider${name}`);
                slider.value = Number.parseInt(slider.value) + 1;
                setColor();
            }
        }
        function decrementor(name) {
            return () => {
                const slider = document.getElementById(`Slider${name}`);
                slider.value = Number.parseInt(slider.value) - 1;
                setColor();
            }
        }

        function setColor() {
            var rgb = elementIdNames.map( name => {
                var slider = document.getElementById(`Slider${name}`);
                const value = Number.parseInt(slider.value);
                document.getElementById(`${name}Value`).innerHTML = `${value}`;
                return value;
            });
            if (grayscale) {
                rgb = [rgb[0], rgb[0], rgb[0]]
                elementIdNames.map( name => {
                    var slider = document.getElementById(`Slider${name}`);
                    slider.value = rgb[0];
                });
            }
            var bgHex = rgb.map(value => {
                var hexval = Math.round(value).toString(16);
                if (hexval.length < 2) {
                    hexval = `0${hexval}`
                }
                return hexval;
            });
            var bgColor = new Color(...rgb);
            var fgColor = getReadableComplement(bgColor, "Luminosity");
            swatch.style.backgroundColor = `#${bgHex.join('')}`;
            swatch.style.color = fgColor.toHex();
            document.getElementById("BGLuminance").innerHTML = bgColor.luminosity().toFixed(4);
            document.getElementById("FGLuminance").innerHTML = fgColor.luminosity().toFixed(4);
            document.getElementById("LuminanceDiff").innerHTML = Math.abs(
                fgColor.luminosity() - bgColor.luminosity()
            ).toFixed(4);
        }

        elementIdNames.map( name => {
            document.getElementById(`Slider${name}`).addEventListener(
                "input", setColor
            );
            document.getElementById(`Sub${name}`).addEventListener(
                "click", decrementor(name)
            );
            document.getElementById(`Add${name}`).addEventListener(
                "click", incrementor(name)
            );
        });

        let auto = false;
        var autoButton = document.getElementById("ButtonAuto");
        autoButton.addEventListener("click", () => {
            auto = !auto
            if (auto) {
                var linkSliders = document.getElementById("LinkSlidersToggle");
                linkSliders.checked = false;
            }
        });

        var autoState = document.getElementById("AutoState");

        window.setInterval(() => {
            autoState.innerHTML = (auto ? "On" : "Off");
            if (!auto) {
                return;
            }
            const rgb = [0, 0, 0].map(item => {
                return Math.round(Math.random() * 255);
            })
            var bgHex = rgb.map((value, index) => {
                var sliderName = `Slider${elementIdNames[index]}`;
                var slider = document.getElementById(sliderName);
                slider.value = value;
                var hexval = Math.round(value).toString(16);
                if (hexval.length < 2) {
                    hexval = `0${hexval}`
                }
                return hexval;
            });
            var complement = getReadableComplement(new Color(...rgb), "Luminosity");
            swatch.style.backgroundColor = `#${bgHex.join('')}`;
            swatch.style.color = complement.toHex();
        }, 1000);

        var linkSliders = document.getElementById("LinkSlidersToggle");
        linkSliders.addEventListener('input', event => {
            grayscale = event.target.checked;
            setGrayscale(grayscale);
        })

        setColor()

    </script>
</body>
</html>